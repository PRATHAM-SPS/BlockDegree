{{#> base}}
{{> layouts/base title="Blogs - Blockdegree"}}

{{#*inline "body-block"}}
{{> includes/hero hero-title="Blogs"}}

<section class="wrap-blogs">
  <button
    class="btn"
    style="float: right"
    type="button"
    onclick="searchByKeyword()"
  >
    Search
  </button>
  <div style="overflow: hidden; padding-right: .5em;">
    <input
      type="text"
      class="form-control"
      id="searchKeywords"
      placeholder="Search By Keyword"
    />
  </div>
  <div id="main-wrapper-blogs"></div>
</section>

{{/inline}}

{{#*inline "scripts-block"}}

<script>
  $("document").ready(function() {
    $.ajax({
      method: "get",
      url: "/api/blogs/loadBlogs",
      success: response => {
        let blogWrapper = document.getElementById("main-wrapper-blogs");
        let retHTML = "";
        if (!response.status) {
          $.notify(response.error, { type: "danger" });
        } else {
          if (response.blogs.length < 1) {
            $.notify("No blogs to show", { type: "danger" });
            return;
          }
          response.blogs.forEach(blog => {
            retHTML +=
              `<div class="card blog-card" onclick="readBlog('${blog.blog_id}')">` +
              `<h3 class="card-title">${blog.title}</h3>` +
              `<p class="card-text" >${blog.desc}</p>` +
              `<h6 class="card-subtitle mb-2 text-muted">Author - ${blog.author}</h6>` +
              `</div>`;
          });
          console.log("InnerHTML: ", retHTML);
          blogWrapper.innerHTML = retHTML;
        }
      }
    });
  });

  function readBlog(blog_id) {
    console.log(`Blog ID: ${blog_id}`);
    window.location.href = `https://www.blockdegree.org/blogs/readBlog?blog_id=${blog_id}`;
  }

  function searchByKeyword() {
    let searchKeywords = document.getElementById("searchKeywords");
    let blogWrapper = document.getElementById("main-wrapper-blogs");
    blogWrapper.innerHTML = "";
    $.ajax({
      method: "post",
      url: "/api/blogs/keywordSearch",
      data: { keyword: searchKeywords.value },
      success: response => {
        if (!response.status) {
          $.notify(response.error, { type: "danger" });
        } else {
          let blogs = response.blogs;
          console.log(blogs);
          if (blogs.length < 1) {
            $.notify(`No blogs found with keyword: ${searchKeywords.value} `, {
              type: "danger"
            });
            blogWrapper.innerHTML = "";
          } else {
            let retHTML = "";
            response.blogs.forEach(blog => {
              retHTML +=
                `<div class="card blog-card" onclick="readBlog('${blog.blog_id}')">` +
                `<h3 class="card-title">${blog.title}</h3>` +
                `<p class="card-text" >${blog.desc}</p>` +
                `<h6 class="card-subtitle mb-2 text-muted">Author - ${blog.author}</h6>` +
                `</div>`;
            });
            blogWrapper.innerHTML = retHTML;
          }
        }
      },
      error: xhr => {
        $.notify("Oops, some error has occured", { type: "danger" });
      }
    });
  }
</script>

{{/inline}}
{{/base}}
