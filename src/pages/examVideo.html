{{#> base}}
{{> layouts/base title="Exam Video Stream"}}
{{#*inline "body-block"}}
{{> includes/hero hero-title="Exam Video Stream"}}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"
    defer></script>
<script src="https://www.WebRTC-Experiment.com/RecordRTC.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/RecordRTC/5.6.1/RecordRTC.js"></script>
<video playsinline autoplay></video>
<button id="btn-stop-recording">Stop Recording</button>
<script>
    let recorder; // globally accessible

    let video = document.querySelector('video');

    function captureCamera(callback) {
        navigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(camera => {
            callback(camera);
        }).catch(error => {
            alert('Unable to capture your camera. Please check console logs.');
            console.error(error);
        });
    }

    function stopRecordingCallback() {
        video.src = video.srcObject = null;
        video.muted = false;
        video.volume = 1;
        video.src = URL.createObjectURL(recorder.getBlob());
        recorder.camera.stop();
        recorder.destroy();
        recorder = null;
    }

    captureCamera(camera => {
        video.muted = true;
        video.volume = 0;
        video.srcObject = camera;
        recorder = RecordRTC(camera, {
            type: 'video'
        });
        recorder.startRecording();
        recorder.camera = camera;
        document.getElementById('btn-stop-recording').disabled = false;
    });

    document.getElementById('btn-stop-recording').onclick = function () {
        this.disabled = true;
        recorder.stopRecording(stopRecordingCallback);
    };
</script>
<script src="https://www.webrtc-experiment.com/common.js"></script>
{{/inline}} {{/base}}